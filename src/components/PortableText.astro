---
import SanityImage from './SanityImage.astro';

interface Props {
	content: any[];
	class?: string;
}

const { content, class: className } = Astro.props;

if (!content || !Array.isArray(content)) {
	return null;
}

function renderBlock(block: any): string {
	if (block._type === 'block') {
		const style = block.style || 'normal';
		const children = block.children || [];

		let text = '';
		for (const child of children) {
			if (child._type === 'span') {
				let spanText = child.text || '';

				// Apply marks
				if (child.marks && child.marks.length > 0) {
					for (const mark of child.marks) {
						if (mark === 'strong') {
							spanText = `<strong>${spanText}</strong>`;
						} else if (mark === 'em') {
							spanText = `<em>${spanText}</em>`;
						}
					}
				}

				text += spanText;
			}
		}

		// Wrap in appropriate tag based on style
		switch (style) {
			case 'h1':
				return `<h1>${text}</h1>`;
			case 'h2':
				return `<h2>${text}</h2>`;
			case 'h3':
				return `<h3>${text}</h3>`;
			case 'blockquote':
				return `<blockquote>${text}</blockquote>`;
			default:
				return `<p>${text}</p>`;
		}
	}

	return '';
}

const htmlContent = content.map(renderBlock).join('');
---

<div class={className} set:html={htmlContent}></div>

{content.map((block) => (
  block._type === 'image' && (
    <SanityImage 
      image={block} 
      alt={block.alt || ''} 
      class="w-full h-auto rounded-lg"
    />
  )
))}