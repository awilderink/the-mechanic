---
import Icon from "./Icon.astro";
import Card from "./Card.astro";
import { getVoorraad } from "../lib/sanity";
import SanityImage from "./SanityImage.astro";

interface Props {
  exclude?: string;
}

const { exclude } = Astro.props;
const otherItems = await getVoorraad({
  uitgelicht: true,
  verkocht: false,
});

const filteredItems = exclude
  ? otherItems.filter((item) => item._id !== exclude)
  : otherItems;

const displayItems = filteredItems.slice(0, 3);
---

<div class="flex flex-col items-stretch gap-6 md:flex-row">
  {
    displayItems.map((item) => {
      return (
        <a class="md:basis-1/3" href={`/voorraad/${item.slug.current}`}>
          <Card>
            <div class="-mx-6 -mt-8 mb-4">
              <SanityImage
                transition:name={item.fotos?.[0].asset._ref}
                image={item.fotos?.[0].asset._ref}
                width={358}
                height={233}
                class="w-full"
              />
            </div>
            <div>{item.merk?.naam}</div>
            <div class="text-neutral-400">{item.titel}</div>
            <div class="mt-8 flex items-center justify-between text-sm">
              <span>
                {!!item.prijs &&
                  Intl.NumberFormat("nl-NL", {
                    style: "currency",
                    currency: "EUR",
                  }).format(Number(item.prijs))}
              </span>
              <Icon
                class="h-10 transition-transform hover:translate-x-1"
                name="circle-arrow-right"
              />
            </div>
          </Card>
        </a>
      );
    })
  }
</div>
